!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>// Description: Jenkinsfile for CI/CD pipeline to deploy a Cloud Run service


pipeline {
  agent any

  environment {
    PROJECT_ID = 'mystical-melody-463806-k9'
    REGION = 'asia-south2'
    SERVICE_NAME = 'lang-api'
    ARTIFACT_REPO = "asia-south2-docker.pkg.dev/${PROJECT_ID}/lang-api"
    IMAGE_NAME = "${SERVICE_NAME}"
    REPO_URL = 'https://github.com/chaudhary-prateek/lang-api.git'
  }

  parameters {
    gitParameter(
      name: 'BRANCH',
      type: 'PT_BRANCH',
      defaultValue: '',
      description: 'Select the Git branch to use',
      branchFilter: 'origin/(.*)',
      useRepository: 'https://github.com/chaudhary-prateek/lang-api.git',
      sortMode: 'DESCENDING',
      selectedValue: 'NONE'
    )

    gitParameter(
      name: 'TAG',
      type: 'PT_TAG',
      description: 'Select a Git tag to use (leave branch empty)',
      defaultValue: '',
      sortMode: 'DESCENDING',
      selectedValue: 'NONE'
      
    )
  }

  stages {
    stage('Checkout Code') {
      steps {
        script {
          echo "ðŸŒ¿ Branch: ${params.BRANCH}"
          echo "ðŸ·ï¸ Tag: ${params.TAG}"

          def repoUrl = 'https://github.com/chaudhary-prateek/lang-api.git'

          if (params.TAG?.trim()) {
            echo "ðŸ“¥ Checking out tag: ${params.TAG}"
            checkout([$class: 'GitSCM',
              branches: [[name: "refs/tags/${params.TAG}"]],
              userRemoteConfigs: [[
                url: repoUrl,
                credentialsId: 'github-token'
                ]]
       
/h1>
</body>
</html>